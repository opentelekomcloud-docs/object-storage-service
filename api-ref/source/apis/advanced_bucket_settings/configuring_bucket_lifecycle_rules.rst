:original_name: obs_04_0034.html

.. _obs_04_0034:

Configuring Bucket Lifecycle Rules
==================================

Functions
---------

This operation configures lifecycle rules that can delete or migrate objects from a bucket at a specified time. Typical application scenarios:

-  Delete periodically uploaded files. Some files uploaded periodically need only to be retained for only one week or one month.
-  Delete files that are frequently accessed within a certain period of time but are seldom accessed afterward. You can archive these files and then schedule the time for deletion.

You can perform this operation to create or update the lifecycle configuration of a bucket.

.. note::

   -  Expired objects deleted based on a lifecycle rule cannot be recovered.

To perform this operation, you must have the **PutLifecycleConfiguration** permission. By default, only the bucket owner can perform this operation. The bucket owner can grant the permission to other users by configuring the bucket policy or user policy.

The lifecycle configuration enables OBS to delete objects and transition object storage classes at a scheduled time. To prevent a user from doing so, the following permissions granted to the user must be revoked:

-  DeleteObject
-  DeleteObjectVersion
-  PutLifecycleConfiguration

If you want to forbid a user to set the bucket lifecycle configuration, revoke the **PutLifecycleConfiguration** permission from the user.

Request Syntax
--------------

.. code-block:: text

   PUT /?lifecycle HTTP/1.1
   Host: bucketname.obs.region.example.com
   Content-Length: length
   Date: date
   Authorization: authorization
   Content-MD5: MD5
   <?xml version="1.0" encoding="UTF-8"?>
   <LifecycleConfiguration>
       <Rule>
           <ID>id</ID>
           <Filter>
               <And>
                   <Prefix>prefix</Prefix>
                   <Tag><Key>key1</Key><Value>value1</Value></Tag>
                   <Tag><Key>key2</Key><Value>value2</Value></Tag>
               </And>
           </Filter>
           <Prefix>prefix</Prefix>
           <Status>status</Status>
           <Expiration>
               <Days>days</Days>
           </Expiration>
           <NoncurrentVersionExpiration>
               <NoncurrentDays>days</NoncurrentDays>
           </NoncurrentVersionExpiration>
           <Transition>
            <Days>30</Days>
             <StorageClass>WARM</StorageClass>
           </Transition>
           <Transition>
            <Days>60</Days>
            <StorageClass>COLD</StorageClass>
           </Transition>
           <NoncurrentVersionTransition>
            <NoncurrentDays>30</NoncurrentDays>
            <StorageClass>WARM</StorageClass>
           </NoncurrentVersionTransition>
           <NoncurrentVersionTransition>
            <NoncurrentDays>60</NoncurrentDays>
            <StorageClass>COLD</StorageClass>
           </NoncurrentVersionTransition>
           <AbortIncompleteMultipartUpload>
               <DaysAfterInitiation>10</DaysAfterInitiation>
           </AbortIncompleteMultipartUpload>
       </Rule>
   </LifecycleConfiguration>

Request Parameters
------------------

This request contains no parameters.

Request Headers
---------------

:ref:`Table 1 <obs_04_0034__table436706591789>` lists the request header.

.. _obs_04_0034__table436706591789:

.. table:: **Table 1** Request headers

   +-----------------------+-------------------------------------------------------------------------+-----------------------+
   | Header                | Description                                                             | Mandatory (Yes/No)    |
   +=======================+=========================================================================+=======================+
   | Content-MD5           | Base64-encoded 128-bit MD5 digest of the message according to RFC 1864. | Yes                   |
   |                       |                                                                         |                       |
   |                       | Type: string                                                            |                       |
   |                       |                                                                         |                       |
   |                       | Example: **n58IG6hfM7vqI4K0vnWpog==**                                   |                       |
   +-----------------------+-------------------------------------------------------------------------+-----------------------+

Request Elements
----------------

In this request body, you need to specify the lifecycle configuration in XML format. :ref:`Table 2 <obs_04_0034__table49391898171726>` describes the specific XML configuration elements.

-  If the versioning of a bucket is enabled or suspended, you can set **NoncurrentVersionTransition** or **NoncurrentVersionExpiration** to control the lifecycle of historical object versions. The lifecycle of a historical version depends on the time when it becomes a historical one (time when the version is replaced by a new version) and the value of **NoncurrentDays**. If **NoncurrentDays** is set to **1** in an object deletion scenario, an object version will be deleted one day after it becomes historical. If the version V1 of object A is created on the first date of a month and new version V2 is uploaded on the fifth date of the month, V1 becomes a historical version. At 00:00 on the seventh date of the month, V1 will expire. If an object version does not meet the deletion conditions, but **NoncurrentDays** is set to **1** and **StorageClass** is set to **WARM**, the version transitions to the Warm storage class one day after it has become a historical version. For example, the V1 version of object A is created on the first day of a month, and its new version V2 is uploaded on the fifth day of the month. Then V1 becomes a historical version. One day later, that is, at 0 o'clock of the seventh day, V1 transitions to the Warm storage class. The deletion or transition of the object after the expiration time may be delayed. The delay is within 48 hours.
-  Objects are processed according to the following procedures, if their latest versions meet the expiration rule and versioning is enabled or suspended for the bucket.

   -  Versioning enabled:

      If the latest object version is not a delete marker, a new delete marker will be inserted for the object.

      If the latest object version is a delete marker and is the only version of the object, this latest version will be deleted.

      If the object of the latest version has the DeleteMarker and the object has other versions, all versions of the object remain unchanged.

   -  Versioning suspended:

      If the latest version of the object does not have the DeleteMarker and is not the null version, the object generates a new DeleteMarker for the null version.

      If the latest version of the object does not have the DeleteMarker but is the null version, this null version is overwritten by a new DeleteMarker generated for the null version.

      If the latest object version is a delete marker and is the only version of the object, this latest version will be deleted.

      If the object of the latest version has the DeleteMarker and the object has other versions, all versions of the object remain unchanged.

-  The following lists the processing when the versioning is enabled or suspended for a bucket and objects of the latest versions meet the transition rules:

   -  If the latest version of the object has the DeleteMarker, the storage class of this version will not be transitioned.
   -  If the latest version of the object does not have the DeleteMarker and meets the transition rule, the storage class of this version will be transitioned.

.. _obs_04_0034__table49391898171726:

.. table:: **Table 2** Response elements for lifecycle configuration

   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Name                           | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Mandatory (Yes/No)                                                                                                                                       |
   +================================+=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+==========================================================================================================================================================+
   | Date                           | Specifies that OBS executes lifecycle rules for objects before the specified date. The date must be compliant with the ISO8601 format, and the time must be compliant with the UTC format of 00:00:00. For example, **2018-01-01T00:00:00.000Z** indicates that objects whose last modification time is earlier than **2018-01-01T00:00:00.000Z** are deleted or transitioned to another storage class. Objects whose last modification time is equal to or later than the specified time are not deleted or transitioned to another storage class. | Yes if the **Days** element is absent.                                                                                                                   |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Expiration, Transition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Days                           | Specifies the number of days (since the latest update to the latest object version) after which the lifecycle rule takes effect.                                                                                                                                                                                                                                                                                                                                                                                                                    | Yes if the **Date** element is absent.                                                                                                                   |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: integer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Expiration, Transition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | StorageClass                   | The storage class to which the object is transitioned.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Yes if the **Transition** or **NoncurrentVersionTransition** element is present.                                                                         |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Value options: **WARM**, **COLD**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Transition, NoncurrentVersionTransition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Transition                     | Transition time and the object storage class after transition (valid only for the latest object version).                                                                                                                                                                                                                                                                                                                                                                                                                                           | Yes if the **NoncurrentVersionTransition**, **Expiration**, **AbortIncompleteMultipartUpload**, and **NoncurrentVersionExpiration** elements are absent. |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: XML                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Child: Date or Days, StorageClass                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Expiration                     | Container for the object expiration rule (only applicable to the latest versions of objects).                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Yes if **Transition**, **NoncurrentVersionTransition**, **AbortIncompleteMultipartUpload**, and **NoncurrentVersionExpiration** are absent.              |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: XML                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Child: Date or Days                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | ID                             | Unique identifier of a rule. The value can contain a maximum of 255 characters.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | No                                                                                                                                                       |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | LifecycleConfiguration         | Container for lifecycle rules. You can add multiple rules. The total size of the rules cannot exceed 20 KB.                                                                                                                                                                                                                                                                                                                                                                                                                                         | Yes                                                                                                                                                      |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: XML                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Child: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: none                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | NoncurrentDays                 | Number of days when the specified rule takes effect after the object becomes a historical version (only applicable to an object's historical version).                                                                                                                                                                                                                                                                                                                                                                                              | Yes if the **NoncurrentVersionExpiration** or **NoncurrentVersionTransition** element is present.                                                        |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: integer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: NoncurrentVersionExpiration, NoncurrentVersionTransition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | NoncurrentVersionTransition    | Transition time of historical object versions and the object storage class after transition.                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Yes if the **Transition**, **Expiration**, **AbortIncompleteMultipartUpload**, and **NoncurrentVersionExpiration** elements are absent.                  |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: XML                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Child: NoncurrentDays, StorageClass                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | NoncurrentVersionExpiration    | Container for the expiration time of objects' historical versions. If versioning is enabled or suspended for a bucket, you can set **NoncurrentVersionExpiration** to delete historical versions of objects that match the lifecycle rule (only applicable to the historical versions of objects).                                                                                                                                                                                                                                                  | No                                                                                                                                                       |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: XML                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Child: NoncurrentDays                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | AbortIncompleteMultipartUpload | Container for specifying when the not merged parts (fragments) in an incomplete upload will be deleted.                                                                                                                                                                                                                                                                                                                                                                                                                                             | Yes if the **Transition**, **Expiration**, **NoncurrentVersionExpiration**, and **NoncurrentVersionTransition** elements are absent.                     |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: XML                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Child: DaysAfterInitiation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                |    AbortIncompleteMultipartUpload does not support filtering by tag.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | DaysAfterInitiation            | Specifies the number of days since the initiation of an incomplete multipart upload that OBS will wait before deleting the not merged parts (fragments) of the upload.                                                                                                                                                                                                                                                                                                                                                                              | Yes if the **AbortIncompleteMultipartUpload** element is present.                                                                                        |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: integer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: AbortIncompleteMultipartUpload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Filter                         | A specific filter. The lifecycle rule will apply to the objects matching this filter in a bucket.                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Either Filter or Prefix can be configured at the same level under Rule.                                                                                  |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | You can filter objects by object key prefix, object tag, or both. If there are multiple filters in a rule, use the And logic to combine them.                                                                                                                                                                                                                                                                                                                                                                                                       | Prefix can be a child node of Filter.                                                                                                                    |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: XML                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | And                            | The And logic among filtering criteria.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Yes if there are multiple Prefix and Tag rules.                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | The And logic can be used when both the object name prefix and object tag are used or multiple object tags are used.                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: XML                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Filter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Constraints:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | #. And must have child nodes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                          |
   |                                | #. If Filter has Tag or Prefix as its child node, And cannot be a child node at the same level as the Tag or Prefix child node under Filter. (Tag and Prefix can be included in And.)                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Tag                            | Specifies which objects can match the current Rule.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | No                                                                                                                                                       |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: container                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Filter or And                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Constraints:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | #. If Tag is configured as a child node of Filter, there can be only one Tag node. If Filter has a Prefix child node, there cannot be any Tag node at the same level with Prefix under Filter.                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                          |
   |                                | #. If Tag is configured under And, there can be a maximum of 10 Tag nodes, and the tag key values must be different.                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                          |
   |                                | #. If AbortIncompleteMultipartUpload exists as a child node of Rule, Tag cannot be configured to filter fragments.                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                          |
   |                                | #. If the tags in multiple rules overlap and lifecycle actions conflict, the configuration is not allowed. For example, rule 1 uses one tag (*key1*, *value1*) and deletes objects 90 days after creation, while rule 2 uses two tags (*key1*, *value1*; *key2*, *value2*) and transitions objects to COLD 120 days after creation. In this case, the tags in two rules overlap and lifecycle actions conflict, so such configuration is not allowed.                                                                                               |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Key                            | The key of the tag.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Yes if Tag is present.                                                                                                                                   |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Tag                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Constraints:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | -  If there are multiple tags specified for an object, each tag key must be unique.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                          |
   |                                | -  A tag key must contain 1 to 36 characters and be case sensitive.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                          |
   |                                | -  A tag key cannot start or end with a space or contain the following characters: ``,/|<>=*\``                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Value                          | The value of the tag.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Yes if Tag is present.                                                                                                                                   |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Tag                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Constraints:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | -  A tag value can contain 0 to 43 characters and must be case sensitive.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                          |
   |                                | -  A tag value cannot contain the following characters: ``,/|<>=*\``                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Prefix                         | Object name prefix that identifies one or more objects to which the rule applies.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Yes                                                                                                                                                      |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Constraints:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | #. When you configure a lifecycle rule by specifying a prefix, if the specified prefix and the prefix of an existing lifecycle rule overlap, OBS regards these two rules as one and forbids you to configure this rule. For example, if there is a rule with the object prefix **abc** configured in the system, another rule with the object prefix starting with **abc** cannot be configured.                                                                                                                                                    |                                                                                                                                                          |
   |                                | #. If there is already a lifecycle rule that is based on an object prefix, you are not allowed to configure another rule that is applied to the entire bucket.                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Rule                           | Container for a specific lifecycle rule.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Yes                                                                                                                                                      |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: container                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: LifecycleConfiguration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Status                         | Indicates whether the rule is enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Yes                                                                                                                                                      |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Parent: Rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                          |
   |                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                          |
   |                                | Value options: **Enabled**, **Disabled**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                          |
   +--------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------+

Response Syntax
---------------

::

   HTTP/1.1 status_code
   Date: date
   Content-Length: length

Response Headers
----------------

The response to the request uses common headers. For details, see :ref:`Table 1 <obs_04_0013__d0e686>`.

Response Elements
-----------------

This response contains no elements.

Error Responses
---------------

No special error responses are returned. For details about error responses, see :ref:`Table 2 <obs_04_0115__d0e843>`.

Sample Request
--------------

.. code-block:: text

   PUT /?lifecycle HTTP/1.1
   User-Agent: curl/7.29.0
   Host: examplebucket.obs.region.example.com
   Accept: */*
   Date: WED, 01 Jul 2015 03:05:34 GMT
   Authorization: OBS H4IPJX0TQTHTHEBQQCEC:DpSAlmLX/BTdjxU5HOEwflhM0WI=
   Content-MD5: ujCZn5p3fmczNiQQxdsGaQ==
   Content-Length: 919

   <?xml version="1.0" encoding="utf-8"?>
   <LifecycleConfiguration>
     <Rule>
       <ID>lifecycle-rule-id</ID>
       <Filter>
         <And>
            <Prefix>prefix</Prefix>
            <Tag><Key>key1</Key><Value>value1</Value></Tag>
            <Tag><Key>key2</Key><Value>value2</Value></Tag>
         </And>
       </Filter>
       <Status>Enabled</Status>
       <Expiration>
         <Days>70</Days>
       </Expiration>
       <NoncurrentVersionExpiration>
         <NoncurrentDays>70</NoncurrentDays>
       </NoncurrentVersionExpiration>
       <Transition>
         <Days>30</Days>
         <StorageClass>WARM</StorageClass>
       </Transition>
       <Transition>
         <Days>60</Days>
         <StorageClass>COLD</StorageClass>
       </Transition>
       <NoncurrentVersionTransition>
         <NoncurrentDays>30</NoncurrentDays>
         <StorageClass>WARM</StorageClass>
       </NoncurrentVersionTransition>
       <NoncurrentVersionTransition>
         <NoncurrentDays>60</NoncurrentDays>
         <StorageClass>COLD</StorageClass>
       </NoncurrentVersionTransition>
     </Rule>
   </LifecycleConfiguration>

Sample Response
---------------

::

   HTTP/1.1 200 OK
   Server: OBS
   x-obs-request-id: BF26000001643670AC06E7B9A7767921
   x-obs-id-2: 32AAAQAAEAABSAAgAAEAABAAAQAAEAABCSvK6z8HV6nrJh49gsB5vqzpgtohkiFm
   Date: WED, 01 Jul 2015 03:05:34 GMT
   Content-Length: 0

Sample Request: Deleting Fragments
----------------------------------

.. code-block:: text

   PUT /?lifecycle HTTP/1.1
   Authorization: OBS H4IPJX0TQTHTHEBQQCEC:iqSPeUBl66PwXDApxjRKk6hlcN4=
   User-Agent: curl/7.29.0
   Host: examplebucket.obs.region.example.com
   Date: Thu, 24 Apr 2025 14:28:22 GMT
   Content-Type: application/xml
   Content-MD5: PBgGafte2ACjUwYxdJA47Q==

   <LifecycleConfiguration>
       <Rule>
           <ID>lifecycle-rule-id</ID>
           <Prefix>test/</Prefix>
           <Status>Enabled</Status>
           <AbortIncompleteMultipartUpload>
               <DaysAfterInitiation>10</DaysAfterInitiation>
           </AbortIncompleteMultipartUpload>
       </Rule>
   </LifecycleConfiguration>

Sample Response: Deleting Fragments
-----------------------------------

.. code-block::

   HTTP/1.1 200 OK
   x-obs-id-2: 32AAAQAAEAABSAAgAAEAABAAAQAAEAABCTlN+glNMVGtTicAnVXkTVDjR5xKSLuH
   x-obs-request-id: 0000018A2BE86742D2C6989CA79E136C
   Server: OBS
   Content-Length: 0
   Date: Thu, 24 Apr 2025 14:28:23 GMT
