:original_name: obs_03_0003.html

.. _obs_03_0003:

Configuring Cross-Region Replication
====================================

Currently, OBS allows you to configure a cross-region replication rule for copying all objects from a source bucket to a destination bucket or multiple cross-region replication rules that match prefixes.

.. note::

   A cross-region replication rule may not take effect immediately upon its configuration. Accordingly, the objects that this rule is applied to may not be replicated immediately after the rule is configured.

Prerequisites
-------------

The source bucket version is 3.0 or later, and cross-region replication is available in the region of the source bucket.

Procedure
---------

#. In the bucket list, click the bucket you want to operate. The **Overview** page is displayed.

#. In the navigation pane, click **Cross-Region Replication**.

#. Click **Create Rule**. The **Create Cross-Region Replication Rule** dialog box is displayed.

#. Configure a cross-region replication rule according to your service needs. For details about the parameters, see :ref:`Table 1 <obs_03_0003__table13168114013116>`.

   .. _obs_03_0003__table13168114013116:

   .. table:: **Table 1** Cross-region replication parameters

      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter             |                                             | Description                                                                                                                                                                                                                                                                                                                             |
      +=======================+=============================================+=========================================================================================================================================================================================================================================================================================================================================+
      | Status                |                                             | Indicates whether to enable or disable the replication rule. The versioning status of the source bucket must be the same as that of the destination bucket.                                                                                                                                                                             |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Source bucket         | Replicate                                   | Indicates objects on which the rule takes effect.                                                                                                                                                                                                                                                                                       |
      |                       |                                             |                                                                                                                                                                                                                                                                                                                                         |
      |                       |                                             | -  **All objects**: The rule applies to all objects in the bucket.                                                                                                                                                                                                                                                                      |
      |                       |                                             | -  **Match by prefix**: The rule applies only to objects with the preset prefix.                                                                                                                                                                                                                                                        |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      |                       | Prefix                                      | -  If you want to apply the rule to objects by prefix, you must set a value no longer than 1024 characters for **Prefix**.                                                                                                                                                                                                              |
      |                       |                                             | -  When **Match by prefix** is selected and the specified prefix overlaps with the prefix of an existing rule, OBS regards the two rules as one and the new one cannot be configured successfully. For example, if a rule with prefix **abc** exists in the system, another rule whose prefix starts with **abc** cannot be configured. |
      |                       |                                             | -  To copy a folder, end the prefix with a slash (/), for example, **imgs/**.                                                                                                                                                                                                                                                           |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      |                       | Synchronize Existing Objects                | Indicates whether to synchronize the objects that were already in the bucket before the rule configuration to the destination bucket. By default, these objects are not synchronized.                                                                                                                                                   |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      |                       | Synchronize Deleting Action                 | Indicates whether to synchronize the object deletions in the source bucket to the destination bucket. With this function enabled, deleting an object from the source bucket will also delete the object copy from the destination bucket.                                                                                               |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      |                       | Replicate KMS encrypted objects             | OBS will try to copy KMS encrypted objects no matter whether this option is selected or not.                                                                                                                                                                                                                                            |
      |                       |                                             |                                                                                                                                                                                                                                                                                                                                         |
      |                       |                                             | -  If this option is selected, only the IAM agencies that have the **KMS Administrator** permissions at both the source and destination ends are displayed in the drop-down list of **IAM Agency** in this dialog box.                                                                                                                  |
      |                       |                                             | -  If this option is not selected, only the IAM agencies that do not have the **KMS Administrator** permission at either the source or destination end are displayed in the drop-down list of **IAM Agency** in this dialog box.                                                                                                        |
      |                       |                                             |                                                                                                                                                                                                                                                                                                                                         |
      |                       |                                             | If KMS is not available in the destination region or the agency does not have the **KMS Administrator** permissions in the source and destination regions, KMS encrypted objects in the source bucket will fail to be replicated to the destination bucket, and the object replication status will be FAILED.                           |
      |                       |                                             |                                                                                                                                                                                                                                                                                                                                         |
      |                       |                                             | After a KMS-encrypted object in the source bucket is replicated to the destination bucket, the key for encrypting the object copy changes to the default key **obs/default** of the region where the destination bucket is located.                                                                                                     |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Destination bucket    | Region                                      | Indicates the region of the destination bucket. The destination and source buckets must be in different regions.                                                                                                                                                                                                                        |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      |                       | Bucket                                      | Indicates the destination bucket.                                                                                                                                                                                                                                                                                                       |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      |                       | Change storage class for replicated objects | By default, this option is not selected, indicating that the storage class of object copies is the same as that of objects in the source bucket. If you need to change the storage class of objects copies, select this parameter, then you can specify a storage class.                                                                |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Permissions           | IAM Agency                                  | Delegates OBS to operate your resources, so that OBS can use this agency to implement cross-region replication.                                                                                                                                                                                                                         |
      |                       |                                             |                                                                                                                                                                                                                                                                                                                                         |
      |                       |                                             | If there is no IAM agency available, click **Create IAM agencies** to create one. If you have already created IAM agencies, select one from the drop-down list.                                                                                                                                                                         |
      |                       |                                             |                                                                                                                                                                                                                                                                                                                                         |
      |                       |                                             | .. note::                                                                                                                                                                                                                                                                                                                               |
      |                       |                                             |                                                                                                                                                                                                                                                                                                                                         |
      |                       |                                             |    Requirements:                                                                                                                                                                                                                                                                                                                        |
      |                       |                                             |                                                                                                                                                                                                                                                                                                                                         |
      |                       |                                             |    The IAM agency must be of OBS. The OBS project must have the **OBS FullAccess** permissions. If **Replicate KMS encrypted objects** is selected, you also need the **KMS Administrator** permissions in the regions where the source and destination buckets are located.                                                            |
      +-----------------------+---------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. (Optional) Create an IAM Agency. For details, see :ref:`Creating an IAM Agency <obs_03_0037>`.

#. Click **OK**. The cross-region replication rule is created.
