:original_name: obs_04_0049.html

.. _obs_04_0049:

Configuring Tags for a Bucket
=============================

Functions
---------

This operation adds tags to a bucket.

After tags are added to a bucket, all service detail records (SDRs) generated by the requests for this bucket will have the same tags. You can categorize the SDRs for detailed cost analysis. For example, if a running application uploads data to a bucket, you can tag the bucket with the application name. In this manner, the costs on the application can be analyzed using tags in SDRs.

To perform this operation, you must have the **PutBucketTagging** permission. By default, only the bucket owner can delete the tags of a bucket. The bucket owner can allow other users to perform this operation by setting a bucket policy or granting them the permission.

.. note::

   -  A bucket can have up to 20 tags.
   -  A tag key and key value can contain a maximum of 36 and 43 characters, respectively.
   -  Tag keys and values cannot contain commas (,), asterisks (*), vertical bars (|), slashes (/), less-than signs (<), greater-than signs (>), equal signs (=), backslashes (\\), or ASCII control character code (0x00 to 0x1F). These tag keys and values must be URL encoded before being sent to a server.

Request Syntax
--------------

.. code-block:: text

   PUT /?tagging HTTP/1.1
   Host: bucketname.obs.region.example.com
   Date: date
   Authorization: authorization string
   Content-MD5: md5
   <Tagging>
       <TagSet>
           <Tag>
               <Key>Tag Name</Key>
               <Value>Tag Value</Value>
           </Tag>
       </TagSet>
   </Tagging>

Request Parameters
------------------

This request contains no message parameters.

Request Headers
---------------

:ref:`Table 1 <obs_04_0049__table436706591789>` lists the request header.

.. _obs_04_0049__table436706591789:

.. table:: **Table 1** Request headers

   +-----------------------+-------------------------------------------------------------------------+-----------------------+
   | Header                | Description                                                             | Mandatory             |
   +=======================+=========================================================================+=======================+
   | Content-MD5           | Base64-encoded 128-bit MD5 digest of the message according to RFC 1864. | Yes                   |
   |                       |                                                                         |                       |
   |                       | Type: string                                                            |                       |
   |                       |                                                                         |                       |
   |                       | Example: **n58IG6hfM7vqI4K0vnWpog==**                                   |                       |
   +-----------------------+-------------------------------------------------------------------------+-----------------------+

Request Elements
----------------

In this request, you must configure bucket tags in the request body. The tag configuration is uploaded in XML format. :ref:`Table 2 <obs_04_0049__table1181123018399>` describes the configuration elements.

.. _obs_04_0049__table1181123018399:

.. table:: **Table 2** Bucket tag configuration elements

   +-----------------------+---------------------------------+-----------------------+
   | Header                | Description                     | Mandatory             |
   +=======================+=================================+=======================+
   | Tagging               | Root element for TagSet and Tag | Yes                   |
   |                       |                                 |                       |
   |                       | Type: container                 |                       |
   |                       |                                 |                       |
   |                       | Parent: none                    |                       |
   +-----------------------+---------------------------------+-----------------------+
   | TagSet                | Element of the tag set          | Yes                   |
   |                       |                                 |                       |
   |                       | Type: container                 |                       |
   |                       |                                 |                       |
   |                       | Parent: Tagging                 |                       |
   +-----------------------+---------------------------------+-----------------------+
   | Tag                   | Information element of Tag      | Yes                   |
   |                       |                                 |                       |
   |                       | Type: container                 |                       |
   |                       |                                 |                       |
   |                       | Parent: TagSet                  |                       |
   +-----------------------+---------------------------------+-----------------------+
   | Key                   | Tag name                        | Yes                   |
   |                       |                                 |                       |
   |                       | Type: string                    |                       |
   |                       |                                 |                       |
   |                       | Parent: Tag                     |                       |
   +-----------------------+---------------------------------+-----------------------+
   | Value                 | Tag value                       | Yes                   |
   |                       |                                 |                       |
   |                       | Type: string                    |                       |
   |                       |                                 |                       |
   |                       | Parent: Tag                     |                       |
   +-----------------------+---------------------------------+-----------------------+

Response Syntax
---------------

::

   HTTP/1.1 status_code
   x-obs-request-id: request id
   x-obs-id-2: id
   Content-Length: length
   Date: date

Response Headers
----------------

The response to the request uses common headers. For details, see :ref:`Table 1 <obs_04_0013__d0e686>`.

Response Elements
-----------------

This response contains no elements.

Error Responses
---------------

In addition to common error codes, this API also returns other error codes. The following table lists common errors and possible causes. For details, see :ref:`Table 3 <obs_04_0049__table12876123320500>`.

.. _obs_04_0049__table12876123320500:

.. table:: **Table 3** Bucket tag configuration errors

   +-------------------+-------------------------------------------------------------------+------------------+
   | Error Code        | Description                                                       | HTTP Status Code |
   +===================+===================================================================+==================+
   | InvalidTagError   | An invalid tag is provided when configuring bucket tags.          | 400 Bad Request  |
   +-------------------+-------------------------------------------------------------------+------------------+
   | MalformedXMLError | An incorrect XML format is provided when configuring bucket tags. | 400 Bad Request  |
   +-------------------+-------------------------------------------------------------------+------------------+

Sample Request
--------------

This example adds a tag whose key is **TagKey(Name1)** and value is **TagValue(Value1)** to bucket **examplebucket**.

.. code-block:: text

   PUT /?tagging HTTP/1.1
   User-Agent: curl/7.29.0
   Host: examplebucket.obs.region.example.com
   Accept: */*
   Date: Wed, 27 Jun 2018 13:22:50 GMT
   Authorization: OBS H4IPJX0TQTHTHEBQQCEC:Pf1ZyGvVYg2BzOjokZ/BAeR1mEQ=
   Content-MD5: MnAEvkfQIGnBpchOE2U6Og==
   Content-Length: 182

   <Tagging xmlns="http://obs.example.com/doc/2015-06-30/">
     <TagSet>
       <Tag>
         <Key>TagKey%28Name1%29</Key>
         <Value>TagValue%28Value1%29</Value>
       </Tag>
     </TagSet>
   </Tagging>

Sample Response
---------------

::

   HTTP/1.1 204 No Content
   Server: OBS
   x-obs-request-id: BF26000001643FEBA09B1ED46932CD07
   x-obs-id-2: 32AAAQAAEAABSAAgAAEAABAAAQAAEAABCSEZp87iEirC6DggPB5cN49pSvHBWClg
   Date: Wed, 27 Jun 2018 13:22:50 GMT
